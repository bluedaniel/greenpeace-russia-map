"use strict";var mapCanvasID="greenpeace-russia-map-canvas",googleDoc="1uPTOGIHvRRNZ7JMyeD6dTNsXsORbMcuNmKx1LcP6hnM",staticUrl="http://energydesk.s3.amazonaws.com/russia-oil-map",bounds,mapOptions,map,infoWindow,overlayHelper,markers=[];var mapStyle=[{featureType:"landscape",stylers:[{saturation:-100},{lightness:65},{visibility:"on"}]},{featureType:"poi",stylers:[{saturation:-100},{lightness:51},{visibility:"simplified"}]},{featureType:"road.highway",stylers:[{saturation:-100},{visibility:"simplified"}]},{featureType:"road.arterial",stylers:[{saturation:-100},{lightness:30},{visibility:"on"}]},{featureType:"road.local",stylers:[{saturation:-100},{lightness:40},{visibility:"on"}]},{featureType:"transit",stylers:[{saturation:-100},{visibility:"simplified"}]},{featureType:"administrative.province",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"labels",stylers:[{visibility:"on"},{lightness:-25},{saturation:-100}]},{featureType:"water",elementType:"geometry",stylers:[{hue:"#ffff00"},{lightness:-25},{saturation:-97}]}];function sidebarUnhighlight(){$("ul.locations").css({"z-index":"0"});$("ul.locations li").removeClass("enabled")}function addMarker(a,b){google.maps.event.addListener(a,"click",function(){infoWindow.setContent('<div class="contentwindow">'+b.join("")+"</div>");infoWindow.open(map,a);map.setZoom(5);map.setCenter(a.getPosition());sidebarUnhighlight();$('ul.locations li a[data-id="'+this.sidebarID+'"]').parent().addClass("enabled")});return true}function offsetCenter(){map.fitBounds(bounds);var g=$("#"+mapCanvasID),d=230,f=0,c,b=overlayHelper.getProjection();var e=new google.maps.LatLngBounds();for(var a in markers){c=b.fromLatLngToContainerPixel(markers[a].getPosition());e.extend(markers[a].getPosition());if(c.x<d&&(c.x<f||!f)){f=c.x}}if(f>0){c=new google.maps.Point(-(d-f),g.height()/2);var h=b.fromContainerPixelToLatLng(c);e.extend(h);map.fitBounds(e)}else{map.fitBounds(bounds)}}function initializeMap(n){bounds=new google.maps.LatLngBounds();mapOptions={center:new google.maps.LatLng(62.24235,92.988281),zoom:8,disableDefaultUI:true,draggable:false,disableDoubleClickZoom:true,styles:mapStyle};map=new google.maps.Map(document.getElementById(mapCanvasID),mapOptions);overlayHelper.setMap(map);infoWindow=new google.maps.InfoWindow({zIndex:500});for(var d=0;d<n.length;d++){var o=n[d];var h=o.latlng.split(";");for(var b=0;b<h.length;b++){var k=h[b].split(",");var e=new google.maps.LatLng(k[0],k[1]);var l={oilplanned:staticUrl+"/images/oil-planned.png",oiloperational:staticUrl+"/images/oil-operational.png",gasplanned:staticUrl+"/images/gas-planned.png",gasoperational:staticUrl+"/images/gas-operational.png",gasoiloperational:staticUrl+"/images/gas-oil-operational.png",oilgasoperational:staticUrl+"/images/gas-oil-operational.png",gasoilplanned:staticUrl+"/images/gas-oil-planned.png",oilgasplanned:staticUrl+"/images/gas-oil-planned.png"};var a=l[$.trim(o.icon).replace(/ /g,"")];var f=new google.maps.MarkerImage(a,null,null,null,new google.maps.Size(28,28));var c=new google.maps.Marker({position:e,title:o.projectName,map:map,icon:f,sidebarID:d});var g=[];g.push('<span class="project">'+o.projectName+"</span>");var m=[];m.push('<b>Partners</b><span class="partners">'+o.partners+"</span>");m.push('<b>Stage</b><span class="stage">'+o.stage+"</span>");g.push('<div class="key-points">'+m.join("")+"</div>");g.push('<span class="info">'+o.size+"</span>");g.push('<span class="more-info"><a href="'+o.link+'" target="_blank">More Info</a></span>');addMarker(c,g);markers.push(c);bounds.extend(e)}$("ul.locations").append('<li><a href="#" data-id="'+d+'">'+o.project+"</a></li>")}google.maps.event.addListenerOnce(map,"idle",function(){offsetCenter()});google.maps.event.addListener(infoWindow,"closeclick",function(){offsetCenter();sidebarUnhighlight();$("ul.locations").css({"z-index":""})})}var doit;window.onresize=function(){clearTimeout(doit);doit=setTimeout(offsetCenter,200)};function loadScript(){var a=document.createElement("script");a.type="text/javascript";a.src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&callback=initializeSpreadsheet";document.body.appendChild(a);$("head").append($('<link rel="stylesheet" type="text/css" />').attr("href",staticUrl+"/styles/main.min.css"))}window.onload=loadScript;function initializeSpreadsheet(){overlayHelper=new google.maps.OverlayView();overlayHelper.onAdd=function(){};overlayHelper.onRemove=function(){};overlayHelper.draw=function(){};var a="https://spreadsheets.google.com/feeds/list/";a+=googleDoc;a+="/od6/public/values";$.getJSON(a,{alt:"json"}).done(function(c){var e=[];for(var b=0;b<c.feed.entry.length;b++){var d=c.feed.entry[b];e.push({projectName:d.gsx$name.$t,partners:d.gsx$partners.$t,project:d.gsx$project.$t,link:d.gsx$link.$t,stage:d.gsx$stage.$t,size:d.gsx$size.$t,icon:d.gsx$icon.$t,latlng:d.gsx$latlng.$t})}$(".loader").hide();$("#"+mapCanvasID).show();initializeMap(e)})}$(function(){$("ul.locations").on("click","li a",function(){sidebarUnhighlight();var a=$(this).data("id");google.maps.event.trigger(markers[a],"click");$(this).parent().addClass("enabled");return false})});